// Biraj Parikh
// EECS 322 w19
// L2 test
// prints {s: 2, 1, {s: 2, 2, {s: 2, 3, {s: 1, 4}}}} by linking the last element of each array with the next created element
// Don't know how to get the compiler to print {s: 1, 4}, which currently prints as ...

(:go
	(:go 0 0
		%N <- 7 // N = 3; r12 -> %N 
		%counter <- 3 // r13 -> %counter
		%arr_size <- 5 // starting array size; rdi -> %arr_size
		%arr_num <- 3 // starting array number; rsi -> %arr_num 
		rdi <- %arr_size
		rsi <- %arr_num
		call allocate 2
		%starting_arr <- rax // save location of master array for printing purposes; r14 -> %starting_arr
		%curr_arr <- rax // r15 -> %curr_arr variable to hold location of each array as each array is iterated through
		
		:two_elem_loop // create two elem arrays until the counter is surpassed
		%counter += 2
		rdi <- %arr_size
		rsi <- %counter
		call allocate 2
		mem %curr_arr 16 <- rax // point final element of previous two elem array at new array
		%curr_arr <- rax // update %curr_arr to the newly created array

		cjump %counter < %N :two_elem_loop :one_elem_arr
		:one_elem_arr
		%arr_size <- 3
		rdi <- %arr_size
		rsi <- %counter 
		call allocate 2
		mem %curr_arr 16 <-rax // point final element of previous two elem array at new one elem array		
		
		rdi <- %starting_arr 
		call print 1
		return  
	)
)
